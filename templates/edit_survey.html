<!-- templates/create_survey.html -->

{% extends 'base.html' %}

{% block title %}Survey Creation{% endblock title %}

{% block content %}

<div>
  <h3>Self Evaluation Questions</h3>
  <table class="ts">
    <thead>
      <tr>
        <th class="ts-70gx">Question</th>
        <th class="ts-zv4m">Question Type</th>
        <th class="ts-zv4m">Weighting</th>
        <th class="ts-zv4m">Evaluation Type</th>
        <th class="ts-zv4m"></th>
      </tr>
    </thead>

    <tbody>
      {% for q in questions %}
        {% if q.evaluation_type == 'S' %}
          <tr>
            <td class=" tdh">{{q.prompt}}</td>
            <td class="ts-0lax tdh">{{q.question_type}}</td>

            {% if q.question_type == 'C' %}
              <td class="ts-0lax tdh">N/A</td>
            {% else %}
              <td class="ts-0lax tdh">{{q.weighting}}</td>
            {% endif %}
            <td class="ts-0lax tdh">{{q.evaluation_type}}</td>

            <td class="ts-0lax tdh">
              <button class="update-question bs-modal btn btn-sm btn-primary" data-form-url="{% url 'update_question' survey.id q.id %}">Edit</button>
              <button class="delete-question bs-modal btn btn-sm btn-danger" data-form-url="{% url 'delete_question' survey.id q.id %}">Remove</button>
            </td>
          </tr>
        {% endif %}
      {% endfor %}

      {% for q in questions %}
        {% if q.evaluation_type == 'P' %}
          <tr>
            <td class=" tdh">{{q.prompt}}</td>
            <td class="ts-0lax tdh">{{q.question_type}}</td>

            {% if q.question_type == 'C' %}
              <td class="ts-0lax tdh">N/A</td>
            {% else %}
              <td class="ts-0lax tdh">{{q.weighting}}</td>
            {% endif %}
            <td class="ts-0lax tdh">{{q.evaluation_type}}</td>

            <td class="ts-0lax tdh">
              <button class="update-question bs-modal btn btn-sm btn-primary" data-form-url="{% url 'update_question' survey.id q.id %}">Edit</button>
              <button class="delete-question bs-modal btn btn-sm btn-danger" data-form-url="{% url 'delete_question' survey.id q.id %}">Remove</button>
            </td>
          </tr>
        {% endif %}
      {% endfor %}

    </tbody>
  </table>
  <button class="create-question bs-modal btn btn-sm btn-danger" data-form-url="{% url 'create_question' survey.id %}">Add Question</button>
</div>


<script type="text/javascript">
$(document).ready(function() {

    // Update question buttons - formURL is retrieved from the data of the element
    $(".update-question").each(function () {
        $(this).modalForm({formURL: $(this).data("form-url")});
        console.log("update question clicked")
    });

    // Delete question buttons - formURL is retrieved from the data of the element
    $(".delete-question").each(function () {
        $(this).modalForm({formURL: $(this).data("form-url"), isDeleteForm: true});
    });

    // Create question button opens form in modal with id="create-  "
    $(".create-book").each(function () {
        $(this).modalForm({formURL: $(this).data("form-url")});
    });

    // autofocus to first input field of a modal
    $('.modal').on('shown.bs.modal', function () {
      $('form').find('input[type=text]').filter(':visible:first').focus();
    });
});
</script>
{% endblock content %}
